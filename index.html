<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Interview Coach</title>
</head>
<body>
  <h2>AI Interview Coach</h2>

  <!-- Resume & JD upload -->
  <input type="file" id="resumeFile" />
  <input type="file" id="jdFile" />
  <button onclick="startInterview()">Start Interview</button>

  <div id="chatBox"></div>

  <!-- Answer box -->
  <input type="text" id="userAnswer" placeholder="Type your answer..." />
  <button onclick="continueInterview()">Submit Answer</button>

  <br /><br />
  <button onclick="getFeedback()">Get Feedback</button>

  <script>
    const WEBHOOK_URL = "YOUR_N8N_WEBHOOK_URL"; // Replace with your n8n webhook

    let interviewData = {
      sessionId: null,
      conversationHistory: [],
      resumeContent: null,
      jdContent: null,
      currentQuestion: 0
    };

    // Utility to read PDF/Files as text (simple version for demo)
    function readFileAsText(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsText(file);
      });
    }

    // Start Interview
    async function startInterview() {
      const resumeFile = document.getElementById('resumeFile').files[0];
      const jdFile = document.getElementById('jdFile').files[0];
      if (!resumeFile || !jdFile) {
        alert("Please upload both Resume and JD");
        return;
      }

      interviewData.resumeContent = await readFileAsText(resumeFile);
      interviewData.jdContent = await readFileAsText(jdFile);

      const response = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'start_interview',
          sessionId: Date.now().toString(),
          resumeContent: interviewData.resumeContent,
          jdContent: interviewData.jdContent
        })
      });

      const result = await response.json();
      interviewData.sessionId = result.session_id;
      interviewData.currentQuestion = 1;

      document.getElementById("chatBox").innerHTML =
        `<p><b>Question 1:</b> ${result.question}</p>`;
    }

    // Continue Interview
    async function continueInterview() {
      const userAnswer = document.getElementById('userAnswer').value;
      if (!userAnswer) {
        alert("Please type an answer first!");
        return;
      }

      // Save conversation history
      interviewData.conversationHistory.push({
        questionNumber: interviewData.currentQuestion,
        answer: userAnswer
      });

      const response = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'continue_interview',
          sessionId: interviewData.sessionId,
          conversationHistory: interviewData.conversationHistory,
          resumeContent: interviewData.resumeContent,
          jdContent: interviewData.jdContent,
          questionNumber: interviewData.currentQuestion + 1,
          answer: userAnswer // ðŸ‘ˆ IMPORTANT
        })
      });

      const result = await response.json();

      interviewData.currentQuestion++;

      document.getElementById("chatBox").innerHTML +=
        `<p><b>Your Answer:</b> ${userAnswer}</p>
         <p><b>Question ${interviewData.currentQuestion}:</b> ${result.question}</p>`;

      document.getElementById("userAnswer").value = "";
    }

    // Get Final Feedback
    async function getFeedback() {
      const response = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'generate_feedback',
          sessionId: interviewData.sessionId,
          conversationHistory: interviewData.conversationHistory
        })
      });

      const result = await response.json();

      document.getElementById("chatBox").innerHTML +=
        `<p><b>Feedback:</b> ${result.feedback}</p>`;
    }
  </script>
</body>
</html>
